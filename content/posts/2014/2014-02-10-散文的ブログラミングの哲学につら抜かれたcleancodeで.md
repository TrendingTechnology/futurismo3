---
author: admin
categories:
- 書評
date: 2014-02-10T05:14:00+00:00
dsq_thread_id:
- 3.6949778e+09
excerpt: CleanCodeが正統すぎてカルチャーショックを受けた
pvc_views:
- 2574
title: 散文的ブログラミングの哲学につら抜かれたCleanCodeでカルチャーショック体験
type: post
url: /archives/=2200
---

ボブおじさんのProfessionalな哲学につら抜かれた本、CleanCodeを読んだ。 

<div class='amazlink-box' style='text-align:left;padding-bottom:20px;font-size:small;/zoom: 1;overflow: hidden;'>
  <div class='amazlink-list' style='clear: both;'>
    <div class='amazlink-image' style='float:left;margin:0px 12px 1px 0px;'>
      <a href='https://www.amazon.co.jp/Clean-Code-%E3%82%A2%E3%82%B8%E3%83%A3%E3%82%A4%E3%83%AB%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E9%81%94%E4%BA%BA%E3%81%AE%E6%8A%80-Robert-Martin/dp/4048676881%3FSubscriptionId%3DAKIAJBCXQ4WQGJ7WU3WA%26tag%3Dsleephacker-22%26linkCode%3Dxm2%26camp%3D2025%26creative%3D165953%26creativeASIN%3D4048676881' target='_blank' rel='nofollow'><img src='https://ecx.images-amazon.com/images/I/51uWxRrPyYL._SL160_.jpg' style='border: none;' /></a>
    </div>
    
    <div class='amazlink-info' style='height:160; margin-bottom: 10px'>
      <div class='amazlink-name' style='margin-bottom:10px;line-height:120%'>
        <a href='https://www.amazon.co.jp/Clean-Code-%E3%82%A2%E3%82%B8%E3%83%A3%E3%82%A4%E3%83%AB%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E9%81%94%E4%BA%BA%E3%81%AE%E6%8A%80-Robert-Martin/dp/4048676881%3FSubscriptionId%3DAKIAJBCXQ4WQGJ7WU3WA%26tag%3Dsleephacker-22%26linkCode%3Dxm2%26camp%3D2025%26creative%3D165953%26creativeASIN%3D4048676881' rel='nofollow' target='_blank'>Clean Code アジャイルソフトウェア達人の技</a>
      </div>
      
      <div class='amazlink-powered' style='font-size:80%;margin-top:5px;line-height:120%'>
        posted with <a href='https://amazlink.keizoku.com/' title='アマゾンアフィリエイトリンク作成ツール' target='_blank'>amazlink</a> at 14.02.10
      </div>
      
      <div class='amazlink-detail'>
        Robert C. Martin
      </div>
      
      <div class='amazlink-sub-info' style='float: left;'>
        <div class='amazlink-link' style='margin-top: 5px'>
          <img src='https://amazlink.fuyu.gs/icon_amazon.png' width='18' /><a href='https://www.amazon.co.jp/Clean-Code-%E3%82%A2%E3%82%B8%E3%83%A3%E3%82%A4%E3%83%AB%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E9%81%94%E4%BA%BA%E3%81%AE%E6%8A%80-Robert-Martin/dp/4048676881%3FSubscriptionId%3DAKIAJBCXQ4WQGJ7WU3WA%26tag%3Dsleephacker-22%26linkCode%3Dxm2%26camp%3D2025%26creative%3D165953%26creativeASIN%3D4048676881' rel='nofollow' target='_blank'>Amazon</a> <img src='https://amazlink.fuyu.gs/icon_rakuten.gif' width='18' /><a href='https://hb.afl.rakuten.co.jp/hgc/g00q0724.n763w947.g00q0724.n763x2b4/archives/c=http%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F6077754%2F&#038;m=http%3A%2F%2Fm.rakuten.co.jp%2Frms%2Fmsv%2FItem%3Fn%3D6077754%26surl%3Dbook' rel='nofollow' target='_blank'>楽天</a>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="outline-container-sec-1" class="outline-2">
  <h2 id="sec-1">
    感想
  </h2>
  
  <div class="outline-text-2" id="text-1">
  </div>
  
  <div id="outline-container-sec-1-1" class="outline-3">
    <h3 id="sec-1-1">
      めくるめくカルチャーショック体験
    </h3>
    
    <div class="outline-text-3" id="text-1-1">
      <p>
        この本は、自分のこれからのコーディングスタイルを変えるかもしれないと思った。 ページをめくる度に、新たな発見と感動を感じた。
      </p>
      
      <p>
        カルチャーショックの詳細は、下の方に列挙するが、ダイジェストを書くと、
      </p>
      
      <ul class="org-ul">
        <li>
          コメントは嘘
        </li>
        <li>
          関数は20行以内
        </li>
        <li>
          コードは上から下へ物語のように書く
        </li>
      </ul>
      
      <p>
        つまり一言で言うと、
      </p>
      
      <p>
        文章のようにコーディングする
      </p>
      
      <p>
        ということ。
      </p></p>
    </div></p>
  </div>
  
  <div id="outline-container-sec-1-2" class="outline-3">
    <h3 id="sec-1-2">
      散文的プログラミング
    </h3>
    
    <div class="outline-text-3" id="text-1-2">
      <p>
        散文的プログラミング、文芸的ブログラミング、それらは考え方としては 知っていたが、所詮は妄想だと思っていた。
      </p>
      
      <p>
        しかし、そのような夢を本気で追求し、かつ実践し、 そのようなことは可能であるということを、具体的な方法で示しているのがこの本。
      </p>
      
      <p>
        この本では、Fitnesseのコードがよく例として引用される。
      </p>
      
      <p>
        それをみると、なるほど完全な文章ではないにしろ、とても綺麗だ。 読んでいて意味が頭に入る。これがCleanCodeなのかと思った。
      </p></p>
    </div></p>
  </div>
  
  <div id="outline-container-sec-1-3" class="outline-3">
    <h3 id="sec-1-3">
      道を極めた男の武道書
    </h3>
    
    <div class="outline-text-3" id="text-1-3">
      <p>
        この本は、～すべし、～べきというような、断定的な表現が多用される。
      </p>
      
      <p>
        冒頭で、この本はアジャイルマスターによる指南書だとかかれている。
      </p>
      
      <p>
        この本にかかれている方法が絶対ではない、とは思う。 武道にも流派はたくさんある。 この本は、道を極めたある男が記した、免許皆伝のための武道書と見ることができる。
      </p></p>
    </div></p>
  </div></p>
</div>

<div id="outline-container-sec-2" class="outline-2">
  <h2 id="sec-2">
    詳細
  </h2>
  
  <div class="outline-text-2" id="text-2">
  </div>
  
  <div id="outline-container-sec-2-1" class="outline-3">
    <h3 id="sec-2-1">
      クリーンコード
    </h3>
    
    <div class="outline-text-3" id="text-2-1">
    </div>
    
    <div id="outline-container-sec-2-1-1" class="outline-4">
      <h4 id="sec-2-1-1">
        プログラミングとは、コードとは
      </h4>
      
      <div class="outline-text-4" id="text-2-1-1">
        <p>
          まず初めに、プログラミングの定義がかかれている。
        </p>
        
        <ul class="org-ul">
          <li>
            機械に実行可能なものとするのがプログラミング、こうした仕様がコード
          </li>
        </ul>
        
        <p>
          コードがなくなることはないと語られている。モデル駆動開発がどんどん洗練されて、コードが自動生成されるようになっても、そのモデルを書くことがコーディングだと言っている（と解釈した）コードは要求の表現なので。
        </p></p>
      </div></p>
    </div>
    
    <div id="outline-container-sec-2-1-2" class="outline-4">
      <h4 id="sec-2-1-2">
        Clean Codeとは
      </h4>
      
      <div class="outline-text-4" id="text-2-1-2">
        <p>
          CleanCodeの定義について、有名人の意見を募っている。一行に要約してみた。
        </p>
        
        <ul class="org-ul">
          <li>
            ビャーネ・ストラウストリップ・・・エレガントで効率がよいもの、１つのことをうまくやるもの
          </li>
          <li>
            グラディ・ブーチ・・・単純で直接的なもの
          </li>
          <li>
            デーブ・トーマス・・・文芸的であるもの
          </li>
          <li>
            マイケル・フェザーズ・・・気配りがきいているもの
          </li>
          <li>
            ロン・ジェフリーズ・・・重複を減らし、表現力を高め、単純な抽象化をしたもの
          </li>
          <li>
            ワード・カンニガム・・・その言語が、その問題のためにつくられたように見えるもの
          </li>
        </ul>
        
        <p>
          また、CleanCodeを書くため方法はこう書かれている。
        </p>
        
        <ul class="org-ul">
          <li>
            きれいなコードを書くためには、骨身を惜しまずに獲得した「きれいさ」のセンスをもって、無数の小さな手法を規律を持って適用する必要があります。この「コードのセンス」が必要なのです。
          </li>
          <li>
            洗練したコードを書くプログラマというのは、まっさらな画面に変形を加えていくことで、エレガントにコーディングされたシステムを造りあげる芸術家なのです。
          </li>
        </ul>
        
        <p>
          エレガントなセンス、という言葉に引っかかった。
        </p>
        
        <p>
          エレガントとは、優雅さ、洗練さとともに、精神性をも意味する。精神性、つまりその人のスタイルで貫かれた洗練さが、CleanCode。 この本にかかれているボブおじさんのスタイルは、まさに個性的なコードだ。
        </p></p>
      </div></p>
    </div>
    
    <div id="outline-container-sec-2-1-3" class="outline-4">
      <h4 id="sec-2-1-3">
        意味のある名前
      </h4>
      
      <div class="outline-text-4" id="text-2-1-3">
        <p>
          名前づけについては、いろいろな本で語られているので新たに知ったことについてのみ、メモする。
        </p>
        
        <ul class="org-ul">
          <li>
            発音可能なものをつける
          </li>
          <li>
            ハンガリアン記法は、悪。
          </li>
        </ul>
        
        <p>
          ハンガリアン記法はコンパイラが型チェックを実装していないときにできたもの。現代のコンパイラは型チェックを行うので、不要。
        </p>
        
        <ul class="org-ul">
          <li>
            メンタルマッピングを避ける。
          </li>
        </ul>
        
        <p>
          メンタルマッピングとは、読んだ人が、ああこれはこの略だと頭の中で変換する思考プロセス。
        </p></p>
      </div></p>
    </div></p>
  </div>
  
  <div id="outline-container-sec-2-2" class="outline-3">
    <h3 id="sec-2-2">
      関数
    </h3>
    
    <div class="outline-text-3" id="text-2-2">
      <p>
        この章はなかなかカルチャーショックな部分が多く、興奮した。
      </p>
      
      <ul class="org-ul">
        <li>
          関数の第一規律は、小さくせよ、第二の規律は、さらに小さくせよ。
        </li>
      </ul>
      
      <p>
        ギャグのような経験則！小さくするための大胆な発言がこの先に続く。
      </p>
      
      <ul class="org-ul">
        <li>
          関数の長さが20行に達することなど、ほとんどないようにすべき
        </li>
        <li>
          if文、else文、while文などのブロック文が1行のながさでなければならない。そうすることで、ドキュメントとしての価値も生まれる。
        </li>
        <li>
          インデントレベルは1つか2つ
        </li>
        <li>
          関数の名前で示される、ある一つの抽象レベルにおけるいくつかのステップでのみ表現されるなら、その関数は一つのことをしています。関数を書く目的は、ある1つのより広い概念を、抽象レベルのいくつかのステップに分解すること。
        </li>
        <li>
          逓減原則: コードは上から下へと物語のように読める必要がある。関数は、抽象レベルの順番に並んでいる必要がある。
        </li>
        <li>
          switch文は、一度しか現れず、多態オブジェクトを生成し、継承の裏にかくされている場合のみ使う。それ以外はつかわない。
        </li>
        <li>
          引数は、理想的には0、その次が1、その次が2。3以上は避ける。引数が多くなったらクラスに抽出する。
        </li>
        <li>
          関数名は、動詞(名詞)の組み合わせ。
        </li>
        <li>
          出力引数は必要ない、thisが代わりになる。出力引数の使用は避ける。
        </li>
        <li>
          コマンド・照会の分離原則: 関数は、何らかの処理を行うか、何らかの応答を返すか(bool)のどちらかを行うべき。
        </li>
        <li>
          エラーコードはつかわず、例外処理を利用する。なぜなら、コードが単純になるので。try/catch内のブロックは関数として外へ出す。初めにtry-catch-finallyを書く。
        </li>
      </ul>
      
      <p>
        どの発言も、自分にとっては衝撃的だ。しかし、筆者は同じ衝撃をケント・ベッグのコードを読んで受けたそうだ。そして、その衝撃を原動力として、自分の手法や考えを洗練させた。自分もそれに倣いたいと思う。
      </p></p>
    </div></p>
  </div>
  
  <div id="outline-container-sec-2-3" class="outline-3">
    <h3 id="sec-2-3">
      コメント
    </h3>
    
    <div class="outline-text-3" id="text-2-3">
      <p>
        コメントも刺激的な発言が多く、頭をピリピリさせる興奮を得る。
      </p>
      
      <ul class="org-ul">
        <li>
          コメントは大して、いやおそらくまったく必要ない！
        </li>
        <li>
          コードでうまく表現するのに失敗したときに、それを補うために使用する。
        </li>
        <li>
          コメントは、メンテナンスされずに嘘が書いてある。コードこそが、真に正確な情報の源。
        </li>
        <li>
          コメントを書く時間があったら綺麗で表現豊かなコードへリファクタリングしろ。
        </li>
      </ul>
      
      <p>
        コメントを文章として書くのではなく、Extract Methodすればよいのか！これが、CleanCodeの極意なのか！
      </p>
      
      <p>
        前の章で、メソッドの長さの目安はせいぜい20行と書いてあった。あまりメソッドの抽出を実施すると、パフォーマンスに影響がでるのでは？
      </p>
      
      <p>
        と思ったが、そのことについては、前に調べたのだった。コンパイラは賢いので、小さいメソッドならばインライン化してくれる。
      </p>
      
      <p>
        <a href="https://futurismo.biz/archives/1939">組込み開発の二大迷信に挑む！リファクタリングにおけるパフォーマンスとスタックオーバーフローについての数値実験</a>
      </p>
      
      <p>
        中途半端に小さいことは駄目なのだ。コンパイラの進化を信じる。もっと小さくが正義。
      </p>
      
      <ul class="org-ul">
        <li>
          コメントアウトは、それを削除する勇気がないだけ。60年代にはコメントアウトする価値はあった。現代は、ソースコード管理システムが覚えているので、もはや必要ない。
        </li>
        <li>
          変更履歴、日誌コメント、これらはソースコード管理システムのなかった時代のもの。全部削除するべきです。
        </li>
      </ul>
      
      <p>
        つまり、ソースコード管理システムで管理するものはソースのなかに書かないということ。こういう考え方もかなりカルチャーショック。
      </p>
      
      <ul class="org-ul">
        <li>
          変数にコメントを強要するルールはまったく馬鹿げている。コードを雑然とさせ、嘘を喧伝し、混乱と無秩序へとコードを誘うでしょう。
        </li>
        <li>
          短い関数に関数ヘッダは不要。関数によく練られた名前をつけ、小さくし、一つのことを行うようにすることは、コメントヘッダをつけることに勝る。
        </li>
      </ul>
      
      <p>
        まったくその通り！仕事だと、自明な関数にも仕事ではコメントを強要される。こういう不自由な規則があるから、メソッドの抽出や名前変更が進まず、モンスター関数が量産される。 関数ヘッダに時間を割くならば、よい関数名や変数名を考えることに時間を割きたいものだ。
      </p></p>
    </div></p>
  </div>
  
  <div id="outline-container-sec-2-4" class="outline-3">
    <h3 id="sec-2-4">
      データ・オブジェクトの非対象性
    </h3>
    
    <div class="outline-text-3" id="text-2-4">
      <ul class="org-ul">
        <li>
          実装の隠蔽とは、抽象化！クラスというのは、変数をゲッタ、セッタを通してクラスの外に伝えるものではない。抽象インタフェースを公開することで、データの実装を知らせることなしに、利用者にデータの本質を操作させる。
        </li>
        <li>
          オブジェクトは、データを隠して抽象化し、データを操作する機能を与える。
        </li>
      </ul>
      
      <p>
        データとオブジェクトの違いを再認識。なにも考えずにgetterとsetterを作るのはpublicにするのと同意。良く考えることにする。
      </p></p>
    </div></p>
  </div>
  
  <div id="outline-container-sec-2-5" class="outline-3">
    <h3 id="sec-2-5">
      クラス
    </h3>
    
    <div class="outline-text-3" id="text-2-5">
      <ul class="org-ul">
        <li>
          クラスの規則は、小さくすること。第二の規則は、もっと小さくすること。責務の数で、小さくする。
        </li>
        <li>
          クラスの簡単な解説は、もし、そして、あるいは、しかし、といった単語以外の単語をつかって、25語以内（日本語だと100文字)程度で作成するべき。
        </li>
        <li>
          単一責務の原則（Single Responsibirity Principle) クラス、モジュールの変更となる原因となるものが1つでなければならない。
        </li>
        <li>
          多くの開発者は、1つの責務を持った小さなクラスが溢れかえることで、全体を見失うのではないかと危惧しています。
        </li>
      </ul>
      
      <p>
        ある一つの大きな作業を行うために、小さなクラスを渡り歩かなければならないかと心配します。 しかし、小さなクラスの集まりとして構成されたシステムは大きな少数のクラスで構成されたシステムよりも、可動部分がすくない。
      </p>
      
      <p>
        この考え方は実物を見るのが早い。この本で出てくるFitnesseのgithubを除くと、そこには小さく分割された無数のファイルとディレクトリがズラズラとならんでいてビックリした。
      </p>
      
      <p>
        git clone git://github.com/unclebob/fitnesse
      </p>
      
      <p>
        小さなクラスが適切に管理されたディレクトリの中に整然と並んでいる。管理の単位がファイルごとではなくて、サブディレクトリごとなのだ。一つ、抽象度が高いのだ。 これも、カルチャーショック。
      </p></p>
    </div></p>
  </div>
  
  <div id="outline-container-sec-2-6" class="outline-3">
    <h3 id="sec-2-6">
      その他
    </h3>
    
    <div class="outline-text-3" id="text-2-6">
      <ul class="org-ul">
        <li>
          説明的変数。プログラムを読みやすくする強力な手法の1つは、計算の途中結果を変数に格納し、その変数に説明的な名前をつける。
        </li>
        <li>
          条件をカブセル化する。条件の意図を示す関数で抽出する。
        </li>
        <li>
          条件の否定形を避ける。否定形の条件は肯定形よりもわかりにくい。
        </li>
      </ul>
    </div></p>
  </div></p>
</div>